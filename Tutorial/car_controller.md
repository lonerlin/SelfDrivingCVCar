# 使用任务列表控制小车

## 什么是任务列表
    根据比赛的任务，小车在行进过程中需要完成直走、后退、巡线、转弯、加减速、暂停等基本任务，或者这些任务的组合，
    例如避障。系统通过摄像头，循环读取每一帧，根据任务要求，对每一帧中的信息进行分析，获取信息，并作出相应的动作。
    如果直接通过CarSerial直接控制马达，会存在以下几个问题。
    - 任务组合复杂，调试艰难。
    - 一帧中可能同时出现需要转弯，暂停，巡线等任务，此时小车马达应该具体执行哪个任务？
    - 多数任务，涉及计时问题。比如停车多少秒，转弯多少秒等。
    为了降低编程的复杂性，系统提供了一个CarController类，用于处理这些复杂的并行任务。CarController首先把任务具体化：
    把任务分成停止，暂停，转弯等等，并给这些任务设定优先级，选择优先级高的任务执行。
        各个函数的优先级如下，数字越小优先级越高：
        0：stop（） 小车完全停止，不能继续行走。
        1：stop（停止时间）暂停一段时间。
        2：Turn  转弯
        2：group 动作的组合。
        3：go_straight 直走
        4：保留
        5：following_line 巡线
    CarController中存储着一个任务列表。在循环中，当判断需要执行某个任务时，调用CarController提供的任务方法（函数）,
    如果有必要，同时提供给任务方法（函数）执行的时间。
    任务方法把任务加入到列表中，系统在每帧循环中，扫描任务列表，并选择优先级最高的任务执行。
    同时在循环中，系统会删除任务列表中那些超时的任务。通过这种方式，来控制小车的各种动作。用户在编程中，
    只需在循环中添加任务，无需手动编程控制小车选择哪一个任务，也无需自己编程计算时间。
    
## 一个任务列表实例

- 时间点1：小车巡线前进
- 时间点2：去到十字路口小车需要转弯2秒，这时巡线任务模块还在执行，但是由于转弯任务优先于巡线，小车执行转弯任务
- 时间点3：小车在转弯过程中，发现前方有行人，必须暂停，礼让行人，这时，优先执行暂停任务。
- 时间点4：小车暂停一秒完成，系统删除列表中的暂停任务，继续执行转弯任务。
- 时间点5：小车转弯2秒完成，系统删除列表中的转弯任务，继续执行巡线任务。
</br>
具体列表和时间参考下图：
![task_list](https://github.com/lonerlin/SelfDrivingCVCar/blob/testing/Tutorial/pic/list.png)
        