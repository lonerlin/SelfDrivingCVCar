# 小车巡线
    巡线是机器人比赛最基本的一个任务，就是小车沿着比赛任务场地上特点的线路行走。一般的方法有光电巡线，红外，摄像头等等，
    使用的技术和方法多种多样。智能小车使用摄像头进行巡线，为了与传统的光电巡线比赛进行衔接，降低比赛难度，智能小车的巡
    线任务较为简单，小车行进的路线基本都是直线，行进路线的中间有黑色或白色的引导线。
    【此处插入图片】
## 小车巡线的基本原理
    小车巡线，首先通过巡线摄像头获取场地的图像，通过ImageInit的实例，把图像处理为二值图，然后在二值图中寻找引导线的中心
    点，计算引导线中心点与图像中心点的位置偏差值，最后以这个偏差值为基础，经过比例换算后，作为两个驱动轮速度的差数值，通
    过CarController的follow_line方法，控制左右驱动轮该笔速度，实现巡线。下面通过一个实例，进一步解释巡线的原理和步骤。
    【总图】
    1.通过巡线摄像头，获取场地信息。
    【原始帧图】
    2.把一帧图像转换为二值图。
    【二值图】
    3.寻找引导线中心点。
    【有线图】
    4.计算引导线中心点至图像中心点的距离。
    【计算距离图】
    5.把距离转换为差速值。
    6.驱动左右两个轮子改变转速。
    7.循环执行步骤1~6，实现小车的巡线。
## 使用follow_line类进行巡线。
    follow_line封装了寻找白线中心点，计算偏移值等功能。使用follow_line方法非常简单，只需要实例化一个follow_line，然后调
    用get_offset方法，指定方法的两个参数。详细的方法参数请参考下表。

    ````python
        __init__(self, width=320, height=240, threshold=20, direction=True, image_type='BINARY')
            初始化巡线类，这里的阀值是指寻找连续白点的最小值，这样可以有效去除因地图反光产生的干扰。
        :param width: 处理图像的宽
        :param height: 处理图像的高
        :param threshold: 阈值，只有连续的白色像素个数超过阈值才认为是白色线
        :param direction:True意味着寻找白色中心点是从左边开始，False是从右边开始
        :param image_type: 其实这个类暂时只能处理二值图，所以这个参数暂时没有作用

    get_offset(self, frame, render_image=None)
            寻找白线偏离图像中心的位置，为了简化，只寻找在图像2/3的部分。通过阀值来控制连续白点的区域，
            这样可以有效减少地图反光对中心点的影响。虽然不完美，也是一种解决办法。
            当找不到线时，返回-1000，告知调用程序找不到白点。
        :param frame: 输入的图像二值图
        :param render_image: 需要渲染的图像，在上面画出一个蓝色的箭头。
        :return: 返回偏离中心点的距离，如果找不到偏置，返回-1000；
                  如果输入了渲染帧，返回渲染帧，否则返回None

    execute(self, frame, render_frame_list)
            给子类提供一个执行的统一接口，子类必须重写本函数
        :param frame: 需要处理的帧
        :param render_frame_list: 需要渲染的帧
        :return: 可能会返回一个处理后的图片

    ````

## 一个完整的巡线实例

## 巡线的一些注意事项
    1.在实例化CarController时，马达初始速度默认是100，根据对速度的需求，马达本身的转速比，可以适当修改base_speed。
    2.在调试的过程中，如果车子左右摆动过大或过小，可以缩小或增大CarController中的比例参数proportional。   
    3.巡线过程有时候会出现引导线完全在摄像头可视范围之外，此时，follow_line实例会返回-1000，表示找不到引导线，
    用户必须对这种情况编程处理。 
    